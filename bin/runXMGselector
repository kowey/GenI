#!/bin/sh

GRAMMAR_FILE=${1}
USERNAME=`whoami`

if [ x${GENI_TMP} == x ]; then
  GENI_TMP=/tmp
fi
TMP_FILE_PREFIX="${GENI_TMP}/geni_to_sel-"${USERNAME}
TMP_RES_PREFIX="${GENI_TMP}/geni_from_sel-"${USERNAME}

TMP_FIL_FILE="${TMP_FILE_PREFIX}-$$.fil"
TMP_RES_FILE="${TMP_RES_PREFIX}-$$.geni"

GRAMMAR_BASENAME=`basename ${GRAMMAR_FILE}`
TMP_FILE_PREFIX_2="${GENI_TMP}/_geni_to_sel-"${USERNAME}-${GRAMMAR_BASENAME}
TMP_RES_PREFIX_2="${GENI_TMP}/_geni_from_sel-"${USERNAME}-${GRAMMAR_BASENAME}
TMP_FIL_FILE_2="${TMP_FILE_PREFIX_2}-$$.fil"
TMP_RES_FILE_2="${TMP_RES_PREFIX_2}-$$.geni"

# write the stuff from stdin into a filter file
cat > ${TMP_FIL_FILE}

time SelectTAG ${GRAMMAR_FILE} ${TMP_FIL_FILE} --geni -o ${TMP_RES_FILE}
CMDEXIT=$?

if [ -r ${TMP_RES_FILE} ]; then
cat ${TMP_RES_FILE}
# clean up previous post-mortem files (declutter)
rm -f ${TMP_FILE_PREFIX_2}* ${TMP_RES_PREFIX_2}*
# move our tmp files in case we need them for post-mortem
mv ${TMP_RES_FILE} ${TMP_RES_FILE_2}
mv ${TMP_FIL_FILE} ${TMP_FIL_FILE_2}
else
  exit 1
fi
